/*

  This snippet erases and regenerates JSONAttribute__c field for a subset of product records.
  The snippet processes only those product records for which the product code contains a certain substring (keySubstring)
  Set keySubstring based on your needs or leave the keySubstring empty to update all product records.
  The processing takes time as it is an asynchronous (batch) job.
  
*/

String keySubstring = 'C-CLASS-VAS1'; 

List<Id> productIds = new List<Id>();


keySubstring = '%' + keySubstring + '%';
List<Product2> productsList = [
  select
    Id,
    Name,
    vlocity_cmt__JSONAttribute__c 
  from
    Product2
  where 
    ProductCode like :keySubstring
  LIMIT 10000];

for (Product2 prod : productsList) {
    prod.vlocity_cmt__JSONAttribute__c = 'JSONAttribute refresh job successfully started. Please allow some processing time to see the results in user interface';
    productIds.add(prod.Id);
}

update productsList;

Database.executeBatch(new vlocity_cmt.EPCProductAttribJSONBatchJob(productIds), 1);

System.debug(LoggingLevel.INFO, 'JSONAttribute refresh job successfully started. Please allow some processing time to see the results in user interface');
System.debug(LoggingLevel.INFO, 'JSONAttribute will be refreshed for ' + productsList.size() + ' product records');